#summary Memory state machine in the Helgrind development branch, will be part of Valgrind 3.4.0

For legend see  MemoryStateMachines. 


    http://data-race-test.googlecode.com/svn/trunk/msm/helgrind340.png
States: 
  * *New* -- the memory has been allocated and never accessed since that. 
  * *RdO* (Read only) -- the memory has been read by one or more threads.
  * *Mod* (Modified) -- the memory has been accessed by one or more threads and at least one access was a write.

|| *Edge* || *Old state* || *Access type*     ||  *Condition*     || *New state* || *Segment set*     || *Lock set*      || *Race if ...* ||
|| E1     || New         || read              ||  -               || RdO         || {currS}           || {currLS}        || - ||
|| E2     || New         || write             ||  -               || Mod         || {currS}           || {currLS}        || - ||
|| E3     || RdO         || read              ||  -               || RdO         || *SS_update*       || *LS_update*     || - ||
|| E4     || RdO         || write             ||  -               || Mod         || *SS_update*       || *LS_update*     || #LS==0 && #SS > 1 ||
|| E5     || Mod         || read              || *HB(SS, currS)*  || RdO         || {currS}           || {currLS}        || -      ||
|| E6 (r) || Mod         || read              || *!HB(SS, currS)* || Mod         || *SS_update*       || *LS_update*     || #LS==0 && #SS > 1 ||
|| E6 (w) || Mod         || write             ||  -               || Mod         || *SS_update*       || *LS_update*     || #LS==0 && #SS > 1 ||
 


*SS_update*:
{{{
  def SS_update:
    newSS = {currS}
    for S in oldSS: 
      if(!HB(S,currS)): 
        newSS.insert(S)
    SS = newSS
}}}

*LS_update*:
{{{
  def LS_update: 
    if(HB(oldSS, currS)): 
      newLS = currLS
    else:
      newLS = intersect(LS, currLS)
    LS = newLS
}}}


Compared to [MSMHelgrind MSMHelgrind 3.3.0] this state machine fixes at least these tests: 
  * False negative *test10*. 
  * False positives *test11*, *test12*, *test13*, *test14*, *test16*, *test17*, *test32*, *test39*, *test40*, *test44*.
This state machine still has several false positives (*test28, test29, test36, test38, test46*).
See tests in RacecheckUnittest. 

Tests *test16, test17, test39* pass with this machine only with BarrierSupport.  
